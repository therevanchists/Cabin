/* GAwesomeBot by Gilbert - Available under the GPL V2 License - Some rights reserved - https://github.com/GilbertGobbels/GAwesomeBot */
const GAwesomeData={},GAwesomeUtil={},GAwesomePaths={},GAwesomeListeners={};GAwesomeData.activity={guildData:{}},GAwesomeData.blog={editor:{}},GAwesomeData.wiki={bookmarks:JSON.parse(localStorage.getItem("wiki-bookmarks"))||[],editor:{}},GAwesomeData.extensions={},GAwesomeData.timers=[],GAwesomeData.dashboard={servers:{}},GAwesomeUtil.dashboard={},GAwesomeData.config={debug:localStorage.getItem("gab:debug")||!1},GAwesomeData.blog.subtitles=["Dolphin Musings","The fault in our syntax","How to go viral","I wish I were a GAB","A robot's memoir","Why do we exist?","What is love?","Updating GAB; my story","What did I ever do to you?","BitQuote made this happen","I didn't want this either","The tragic story","Developer Vs. Bot","What did we mess up today?","Where are your fingers?","Beautiful Duwang","Nominated for best GAB-related blog","Add to bookmarks, but only if you want to","New posts every randomized time period!","It's like free education","These really aren't funny"],GAwesomeData.extensions.html={start:{"#installer-title":"Installing $EXTNAME","#installer-subtitle":"Extension Information"},config:{global:()=>{GAwesomeData.extensions.state.data.server=GAwesomeData.extensions.servers.find(e=>e.id===$("#installer-serverSelect").val()),$("#installer-selector").hide()},"#installer-continue":()=>'\n\t\t\t\tNext &nbsp;\n\t\t\t\t<span class="icon is-small">\n\t\t\t\t\t<i class="fa fa-arrow-right"></i>\n\t\t\t\t</span>\n\t\t\t',"#installer-subtitle":()=>"Extension Configuration","#installer-content":()=>{let e=`\n\t\t\t\t<div class="box has-text-left">\n\t\t\t\t<h4 class="subtitle is-4">\n\t\t\t\t\tOptions for <strong>${GAwesomeData.extensions.state.extension.name}</strong>\n\t\t\t\t</h4>\n\t\t\t\t`;["keyword","command"].includes(GAwesomeData.extensions.state.extension.type)&&(e+='\n\t\t\t\t<div class="field">\n\t\t\t\t\t<label class="label">Permissions</label>\n\t\t\t\t\t<div class="control">\n\t\t\t\t\t\t<span class="select is-primary">\n\t\t\t\t\t\t\t<select name="installer-adminLevel">\n\t\t\t\t\t\t\t\t<option value="0" selected>@everyone</option>\n\t\t\t\t\t\t\t\t<option value="1">Admin level &ge;1</option>\n\t\t\t\t\t\t\t\t<option value="2">Admin level &ge;2</option>\n\t\t\t\t\t\t\t\t<option value="3">Admin level &ge;3</option>\n\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<span class="help">The extension will only respond to members that have the selected bot admin level (or higher).</span>\n\t\t\t\t</div>'),e+='\n\t\t\t\t<div class="field">\n\t\t\t\t\t<label class="label">Channel(s)</label>\n\t\t\t\t',$.get(`/api/servers/${GAwesomeData.extensions.state.data.server.id}/channels`,t=>{Object.values(t).filter(e=>"text"===e.type).sort((e,t)=>e.rawPosition-t.rawPosition).forEach(t=>{e+=`\n\t\t\t\t\t\t<label class="checkbox">\n\t\t\t\t\t\t<input name="installer-disabled_channel_ids-${t.id}" class="installer-disabled_channel_ids" type="checkbox">\n\t\t\t\t\t\t\t#${t.name}\n\t\t\t\t\t\t</label>\n\t\t\t\t\t\t<br>`}),e+='\n\t\t\t\t</div>\n\t\t\t\t<div class="field">\n\t\t\t\t\t<div class="control has-addons">\n\t\t\t\t\t\t<a class="button is-small" onclick="GAwesomeUtil.toggleChannels(\'installer-disabled_channel_ids\', true);">\n\t\t\t\t\t\t\t<span>Select All</span>\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t<a class="button is-small" onclick="GAwesomeUtil.toggleChannels(\'installer-disabled_channel_ids\', false);">\n\t\t\t\t\t\t\t<span>Deselect All</span>\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</div>\n\t\t\t\t\t<span class="help">The extension will run only in these channels.</span>\n\t\t\t\t</div></div>',$("#installer-content").html(e)})}},confirm:{"#installer-continue":()=>"Install","#installer-subtitle":()=>"Confirmation"}},GAwesomeUtil.setInterval=((...e)=>{const t=setInterval(...e);return GAwesomeData.timers.push(t),t}),GAwesomeUtil.reload=(()=>window.location.reload(!0)),GAwesomeUtil.refresh=(()=>Turbolinks.visit("")),GAwesomeUtil.snapshot=(e=>{const t=document.getElementsByTagName(e)[0];if(!Turbolinks||!Turbolinks.controller)return;const o=Turbolinks.controller.cache.snapshots;return t&&o&&o[window.location.href]&&(o[window.location.href][e]=t.cloneNode(!0)),o[window.location.href]}),GAwesomeUtil.log=((e,t,o)=>{if(GAwesomeData.config.debug||o)return!e||"string"!=typeof e||t&&!["log","warn","error"].includes(t)?console.warn("[GAwesomeBot] [WARN] Invalid Arguments for log()"):void console[t||"log"](`[GAwesomeBot] [${"log"!==t&&t?t.toUpperCase():"DEBUG"}] ${e}`)}),GAwesomeUtil.error=(e=>GAwesomeUtil.log(e,"error",!0)),GAwesomeUtil.warn=(e=>GAwesomeUtil.log(e,"warn",!0)),GAwesomeUtil.debugDump=(()=>{GAwesomeUtil.log("[DUMP:INFO] Pass this information to a GAB Support Member and they will assist you further!","log",!0);const{dashboard:{socket:e},builder:t}=GAwesomeData;GAwesomeData.dashboard.socket&&(GAwesomeData.dashboard.socket={}),GAwesomeData.builder&&(GAwesomeData.builder={}),GAwesomeUtil.log(`[DUMP:APPDATA] ${JSON.stringify(GAwesomeData)}`,"log",!0),GAwesomeData.dashboard.socket=e,GAwesomeData.builder=t,GAwesomeUtil.log(`[DUMP:SESSIONDATA] ${JSON.stringify(localStorage)}`,"log",!0),GAwesomeUtil.log(`[DUMP:LIBDATA] ${JSON.stringify({tl:"undefined"!=typeof Turbolinks,io:"undefined"!=typeof io,np:"undefined"!=typeof NProgress,fs:"undefined"!=typeof saveAs,sa:"undefined"!=typeof swal,ac:"undefined"!=typeof AutoComplete,cm:"undefined"!=typeof CodeMirror,md:"undefined"!=typeof md5})}`,"log",!0)}),GAwesomeUtil.toggleAds=(e=>{document.cookie=`adsPreference=${"true"!==e}; path=/`,GAwesomeUtil.refresh()}),GAwesomeUtil.SFS=(()=>{try{$("#builder-code-box").val(cm.getDoc().getValue())}catch(e){}GAwesomeData.IFS=$("#form").serialize(),GAwesomeData.HUM=!0,$("#form-submit span:nth-child(2)").html("Save"),GAwesomeUtil.snapshot("body")}),GAwesomeUtil.submitForm=(()=>{$("#form-submit").addClass("is-loading"),GAwesomeData.HUM=!0,GAwesomeData.builders&&Object.values(GAwesomeData.builders).forEach(e=>e.save()),$.ajax({method:"POST",url:location.pathname+location.search,data:$("#form").serialize()}).always(e=>{GAwesomeUtil.SFS();const t=$("#form-submit");t.removeClass("is-loading"),"OK"!==e&&200!==e.status&&302!==e.status?(GAwesomeUtil.log(`Failed to save dashboard settings. Server returned status ${e.status}.`,"error"),t.find("span:nth-child(1)").html("<i class='fa fa-exclamation'></i>"),t.find("span:nth-child(2)").html("Error")):t.find("span:nth-child(2)").html("Saved"),$(".menu-modifier").each((e,t)=>{t=$(t);const o=$(t.data("modifies"));t.is(":checked")?o.removeClass("is-hidden"):o.addClass("is-hidden")})})}),GAwesomeUtil.setUserAutocomplete=(e=>{const t=e=>new AutoComplete({selector:".user-autocomplete",minChars:2,source:(t,o)=>{t=t.toLowerCase(),o(e.filter(e=>e.toLowerCase().includes(t)))}}),o=GAwesomeUtil.dashboard.getCache(e,"userlist");if(o)return t(o);$.getJSON(`/api/list/users${e?`?svrid=${e}`:""}`,o=>{t(o),GAwesomeUtil.dashboard.setCache(e,"userlist",o)})}),GAwesomeUtil.updateHeader=(()=>{const e=$(`#nav-${window.location.pathname.split("/")[1]}`);e&&e.addClass("is-tab")}),GAwesomeUtil.toggleChannels=((e,t)=>{const o=document.getElementsByClassName(e),s=o.length;for(let e=0;e<s;e++)o[e].checked=t}),GAwesomeUtil.switchActivityLayout=(e=>{switch(e?localStorage.setItem("servers-layout",e):(e=localStorage.getItem("servers-layout"))||(localStorage.setItem("servers-layout","grid"),e=localStorage.getItem("servers-layout")),e){case"grid":$("#grid-layout-button").addClass("is-primary"),$("#list-layout").addClass("is-hidden"),$("#grid-layout").removeClass("is-hidden"),$("#list-layout-button").removeClass("is-primary");break;case"list":$("#list-layout-button").addClass("is-primary"),$("#list-layout").removeClass("is-hidden"),$("#grid-layout-button").removeClass("is-primary"),$("#grid-layout").addClass("is-hidden")}}),GAwesomeUtil.activityBanGuild=(e=>{confirm("Are you sure you want to remove this guild from the activity page? It will no longer be visible on this page.")&&$.post("/dashboard/maintainer/servers/server-list",{removeFromActivity:e}).done(()=>{const t=$(`#cardContent-${e}`);GAwesomeData.activity.guildData[e]=t.html(),t.html(`\n\t\t\t\t<a class="has-text-centered is-4" href="javascript:GAwesomeUtil.activityUnbanGuild('${e}')">\n    \t\t\t<span class="icon">\n        \t\t<i class="fa fa-refresh"></i>\n    \t\t\t</span>\n    \t\t\tUndo ban\n\t\t\t\t</a>\n\t\t\t`),t.addClass("has-text-centered")})}),GAwesomeUtil.activityUnbanGuild=(e=>{$.post("/dashboard/maintainer/servers/server-list",{unbanFromActivity:e}).done(()=>{const t=$(`#cardContent-${e}`);t.removeClass("has-text-centered"),t.html(GAwesomeData.activity.guildData[e])})}),GAwesomeUtil.activityViewportUpdate=(e=>{"activity"!==window.location.pathname.split("/")[1]&&"extensions"!==window.location.pathname.split("/")[1]||(e.matches?($(".header-search-box").removeClass("is-large"),document.getElementById("frame").style.paddingLeft="15px",document.getElementById("frame").style.paddingRight="15px","/activity/users"!==window.location.pathname&&GAwesomeUtil.switchActivityLayout("list")):($(".header-search-box").addClass("is-large"),document.getElementById("frame").style.paddingLeft="0px",document.getElementById("frame").style.paddingRight="0px"))}),GAwesomeUtil.uploadContent=((e,t)=>{if(e){const o=new FileReader;o.onload=(e=>{GAwesomeData[t].editor.value(e.target.result)}),o.readAsText(e[0]),document.getElementById("composer-content-upload").value=null}}),GAwesomeUtil.uploadCode=(e=>{if(e){const t=new FileReader;t.onload=(e=>{GAwesomeData.builder.getDoc().setValue(e.target.result)}),t.readAsText(e[0]),document.getElementById("builder-code-upload").value=null}}),GAwesomeUtil.downloadContent=(()=>{const e=new Blob([document.getElementById("composer-content").value],{type:"text/markdown;charset=utf-8"});saveAs(e,`${document.getElementById("composer-title").value||"Untitled"}.md`)}),GAwesomeUtil.downloadCode=(e=>{const t=new Blob([GAwesomeData.builder.getValue()],{type:"text/markdown;charset=utf-8"});saveAs(t,`${e||document.getElementById("builder-title").value||"Untitled"}.gabext`)}),GAwesomeUtil.loadSource=((e,t,o)=>(GAwesomeData.extensions.source||(GAwesomeData.extensions.source={}),GAwesomeData.extensions.source[e]?GAwesomeUtil.showSource(e,t,o,GAwesomeData.extensions.source[e]):$.get(`/extensions/${e}?v=${t}`,s=>(GAwesomeData.extensions.source[e]=s,GAwesomeUtil.showSource(e,t,o,s)),"text"))),GAwesomeUtil.showSource=((e,t,o,s)=>{$("#extension-source-download").attr({href:`/extensions/${e}?v=${t}`,download:`${o}.gabext`}),$("#extension-source-name").html(o),GAwesomeData.builder&&document.body.contains(GAwesomeData.builder.getTextArea())||(GAwesomeData.builder=CodeMirror.fromTextArea(document.getElementById("extension-source-viewer"),{mode:"javascript",lineWrapping:!0,lineNumbers:!0,fixedGutter:!0,styleActiveLine:!0,readOnly:!0,theme:"monokai"})),GAwesomeData.builder.setValue(s),$("html").addClass("is-clipped"),$("#extension-source-modal").addClass("is-active"),setImmediate(()=>GAwesomeData.builder.refresh())}),GAwesomeUtil.searchWiki=(e=>{Turbolinks.visit(`/wiki?q=${encodeURIComponent(e)}`)}),GAwesomeUtil.getBookmarkLink=(e=>`${window.location.pathname.split("/").slice(-1)[0]}#${e}`),GAwesomeUtil.bookmarkWikiSection=(e=>{const t=GAwesomeUtil.getBookmarkLink(e.parentNode.id);GAwesomeData.wiki.bookmarks.indexOf(t)>-1?GAwesomeData.wiki.bookmarks.splice(GAwesomeData.wiki.bookmarks.indexOf(t),1):GAwesomeData.wiki.bookmarks.push(t),localStorage.setItem("wiki-bookmarks",JSON.stringify(GAwesomeData.wiki.bookmarks)),$(e).toggleClass("is-dark is-text"),GAwesomeUtil.populateWikiBookmarks()}),GAwesomeUtil.populateWikiSections=(()=>{let e="<ul>";const t=document.getElementById("frame").querySelectorAll("h1, h2, h3");for(let o=0;o<t.length;o++)o>0&&"H3"!==t[o].tagName&&t[o-1]&&"H3"===t[o-1].tagName&&(e+="</ul>"),e+="<li>","H3"===t[o].tagName&&(o>0&&t[o-1]&&"H3"!==t[o-1].tagName||0===o)&&(e+="<ul>"),e+=`<a class='heading-shortcut-link' href='#${t[o].id}' data-turbolinks='false'>${t[o].innerHTML}</a></li>`,t[o].innerHTML+=`&nbsp;<a class='button is-text ${"H3"===t[o].tagName?"is-small":""} heading-shortcut-link' style='text-decoration:none;' href='#${t[o].id}' data-turbolinks='false'><i class='fa fa-link'></i></a>&nbsp;<a class='button ${GAwesomeData.wiki.bookmarks.indexOf(GAwesomeUtil.getBookmarkLink(t[o].id))>-1?"is-dark":"is-text"} ${"H3"===t[o].tagName?"is-small":""}' style='text-decoration:none;' onclick='GAwesomeUtil.bookmarkWikiSection(this);'><i class='fa fa-bookmark'></i></a>`;e+="</ul>",t[t.length-1]&&"H3"===t[t.length-1].tagName&&(e+="</ul>"),$("#submenu").html(e),$("table").addClass("table"),$(".heading-shortcut-link").click(function(){$("html, body").animate({scrollTop:$(`#${this.href.substring(this.href.lastIndexOf("#")+1)}`).offset().top},172)})}),GAwesomeUtil.populateWikiBookmarks=(()=>{if(GAwesomeData.wiki.bookmarks.length>0){$("#bookmarks-menu").removeClass("is-hidden"),$("#menu-spacer").removeClass("is-hidden"),GAwesomeData.wiki.bookmarks=GAwesomeData.wiki.bookmarks.sort();let e="<ul>";for(let t=0;t<GAwesomeData.wiki.bookmarks.length;t++)e+=`<li><a href='${GAwesomeData.wiki.bookmarks[t]}' data-turbolinks='false'>${decodeURI(GAwesomeData.wiki.bookmarks[t]).replace("#"," &raquo; ")}</a></li>`;e+="</ul>",$("#bookmarks-submenu").html(e)}else $("#bookmarks-menu").addClass("is-hidden"),$("#menu-spacer").addClass("is-hidden")}),GAwesomeUtil.isLoading=(e=>$(e).addClass("is-loading")),GAwesomeUtil.isFinished=(e=>$(e).removeClass("is-loading")),GAwesomeUtil.publishExtension=(e=>{confirm("Are you sure you want to publish this extension? Everyone will be able to view and use this extension!")&&(NProgress.start(),$(`#publish-${e}`).remove(),$.ajax({type:"POST",url:`/extensions/${e}/publish`,data:{}}).always(()=>{NProgress.done(),NProgress.remove()}))}),GAwesomeUtil.deleteExtension=((e,t)=>{confirm("Are you sure you want to delete this extension? This action is irreversible!")&&(NProgress.start(),$.ajax({type:"POST",url:`/extensions/${e}/delete`,data:{}}).always(()=>{t?GAwesomeUtil.removeElement($(`#${t}`),null,null):$(`#delete-${e}`).parent().parent().remove(),NProgress.done(),NProgress.remove()}))}),GAwesomeUtil.saveExtension=((e,t)=>{NProgress.start(),GAwesomeData.HUM=!0;const o=$("#form").serializeArray();o.find(e=>"code"===e.name).value=GAwesomeData.builder.getValue(),$.ajax({method:"POST",url:e?t:window.location.pathname+window.location.search,data:o}).always(o=>{const s=$("#form-submit");NProgress.done(),NProgress.remove(),GAwesomeUtil.SFS(),"OK"!==o&&200!==o.status&&302!==o.status?(s.find("span:nth-child(1)").html("<i class='fa fa-exclamation'></i>"),s.find("span:nth-child(2)").html("Error")):e?Turbolinks.visit("/extensions/my"):Turbolinks.visit(t)})}),GAwesomeUtil.voteExtension=(e=>{const t=$(`#vote-${e}`),o=t.html().trim();t.html("-1"===o?"+1":"-1"),$.post(`/extensions/${e}/upvote`);const s=$(`#points-${e}`);s.html("-1"===o?Number(s.html())-1:Number(s.html())+1)}),GAwesomeUtil.unpublishExtension=(e=>{if(!confirm("Are you sure you want to unpublish this extension? It will no longer be usable or visible by guilds, points are preserved."))return;NProgress.start();const t=$(`#card-${e}`);$.post(`/extensions/${e}/unpublish`),t.remove(),NProgress.done(),NProgress.remove()}),GAwesomeUtil.rejectExtension=(e=>{let t=prompt("Reason to reject:");if(""===t)t="No reason given.";else if(null===t)return;NProgress.start(),$.ajax({method:"POST",url:`/extensions/${e}/reject`,data:{reason:t}}).done(()=>{$(`#card-${e}`).remove(),NProgress.done(),NProgress.remove()})}),GAwesomeUtil.removeExtension=(e=>{let t=prompt("Reason to remove:");if(""===t)t="No reason given.";else if(null===t)return;NProgress.start(),$.ajax({method:"POST",url:`/extensions/${e}/remove`,data:{reason:t}}).done(()=>{$(`#card-${e}`).remove(),NProgress.done(),NProgress.remove()})}),GAwesomeUtil.acceptExtension=(e=>{NProgress.start(),$.post(`/extensions/${e}/accept`).done(()=>{NProgress.done(),NProgress.remove(),Turbolinks.visit("/extensions/gallery")})}),GAwesomeUtil.featureExtension=(e=>{const t=$(`#feature-${e}`),o="Feature"!==t.html().trim();t.html(o?"Feature":"Unfeature"),$.post(`/extensions/${e}/feature`),$(`#featured-${e}`).html(o?"":'<span class="tag is-primary">Featured</span>&nbsp;')}),GAwesomeUtil.openExtensionInstaller=((e,t,o)=>{GAwesomeUtil.log("Launching extension installer in window");const s=window.screen.width-600,a=window.screen.height-800;GAwesomeData.extensions.window=window.open(`/extensions/${e}/install?v=${t}${o?`&svrid=${o}&update=true`:""}`,"GAB Extension Installer",`height=800,width=600,left=${s/2},top=${a/2}`),GAwesomeData.extensions.window.focus()}),GAwesomeUtil.installExtension=(({target:e})=>{GAwesomeUtil.log("[INSTALLER] Start install");const t=new URLSearchParams(window.location.search),o=$(e);o.addClass("is-loading");const s=`${$(".installer-step-form").serialize()}&v=${t.get("v")}`;GAwesomeUtil.log(`[INSTALLER] Send POST with form data '${s}'`),$.ajax({method:"POST",url:`/dashboard/${t.get("svrid")}/other/extensions`,data:s}).always(e=>{"OK"!==e&&200!==e.status?(GAwesomeUtil.log(`[INSTALLER] Received non-OK status code from POST request. Response Code: ${e.status}`,"error"),swal("Failed to install extension.","Contact support or try again later.","error").then(()=>o.removeClass("is-loading")).catch()):(GAwesomeUtil.log("[INSTALLER] POST request successful."),o.removeClass("is-loading"),swal("Successfully installed extension!","You can now close this window.","success").then(()=>window.close()).catch())})}),GAwesomeUtil.updateExtension=(e=>{GAwesomeUtil.SFS(),NProgress.start(),e.addClass("is-loading");const t=e.data("extid"),o=`${$(`#extension-update-form-${t}`).serialize()}`;$.ajax({method:"POST",url:window.location.pathname,data:o}).always(t=>{NProgress.done(),"OK"!==t&&200!==t.status?swal("Failed to update extension.","Contact support or try again later.","error").then(()=>e.removeClass("is-loading")).catch():e.removeClass("is-loading")})}),GAwesomeUtil.uninstallExtension=(e=>{NProgress.start();const t=$(`#extension-${e}`),o=`${window.location.pathname}/${e}`;GAwesomeUtil.removeElement(t,null,o)}),GAwesomePaths.extensions=(()=>{"/extensions/builder"===window.location.pathname?(setTimeout(()=>GAwesomeUtil.SFS(),0),GAwesomeData.builder=CodeMirror.fromTextArea(document.getElementById("builder-code-box"),{mode:"javascript",lineWrapping:!0,lineNumbers:!0,fixedGutter:!0,styleActiveLine:!0,theme:"monokai"}),GAwesomeData.builder.refresh()):window.location.pathname.endsWith("/install")&&$("#installer-submit").click(GAwesomeUtil.installExtension)}),GAwesomeUtil.updateBlogSubtitle=(()=>{const e=$("#blog-header-subtitle"),t=GAwesomeData.blog.subtitles[Math.floor(Math.random()*GAwesomeData.blog.subtitles.length)];e.fadeOut({duration:500}).queue(o=>{e.html(t),o()}).fadeIn({duration:500})}),GAwesomeUtil.dashboardWrapper=(e=>"dashboard"!==window.location.pathname.split("/")[1]?"This function can only be executed within the dashboard.":e()),GAwesomeUtil.dashboard.connect=(()=>GAwesomeUtil.dashboardWrapper(()=>{GAwesomeData.dashboard.socket&&(GAwesomeUtil.log("Closing stale Dashboard socket"),GAwesomeData.dashboard.socket.close()),GAwesomeUtil.log("Opening new Dashboard socket"),GAwesomeData.dashboard.socket=io(window.location.pathname,{transports:["websocket"]}),GAwesomeData.dashboard.socket.on("update",e=>{GAwesomeUtil.log(`Received Socket data: ${JSON.stringify(e)}`),GAwesomeData.HUM||GAwesomeData.dashboard.svrid!==e.location||"none"===localStorage.getItem("dashboardUpdates")||($("html").addClass("is-clipped"),$("#update-modal").addClass("is-active"))}),GAwesomeData.dashboard.socket.on("err",e=>{GAwesomeUtil[e.fatal?"error":"warn"](`Dashboard Socket responded with a ${e.error} error code.`)}),GAwesomeData.dashboard.socket.on("logs",e=>{const t=`[${e.timestamp}] [${e.level}] ${e.message}`;GAwesomeData.dashboard.terminal.print(t),$(".Terminal").animate({scrollTop:$(".Terminal").prop("scrollHeight")},500)})})),GAwesomeUtil.dashboard.setCache=((e,t,o,s=300)=>{GAwesomeData.cache||(GAwesomeData.cache=new Map),GAwesomeData.cache.has(e)||GAwesomeData.cache.set(e,new Map),GAwesomeData.cache.get(e).set(t,{data:o,expireAt:Math.floor(Date.now()/1e3)+s})}),GAwesomeUtil.dashboard.getCache=((e,t)=>{if(!GAwesomeData.cache||!GAwesomeData.cache.has(e)||!GAwesomeData.cache.get(e).has(t))return;const o=GAwesomeData.cache.get(e).get(t);if(!(o.expireAt<Math.floor(Date.now()/1e3)))return o.data;GAwesomeData.cache.get(e).delete(t)}),GAwesomeUtil.removeElement=((e,t,o)=>{const s=()=>{e.fadeOut(400,()=>{const o=e.is(":only-child");e.remove(),o&&(t&&t.addClass("is-hidden"),$(".no-elements-message").removeClass("is-hidden")),GAwesomeUtil.SFS(),NProgress.done(),NProgress.remove()})};o?$.ajax({url:o,method:"DELETE"}).always(s):s()}),GAwesomeUtil.dashboard.removeTableElement=(e=>GAwesomeUtil.dashboardWrapper(()=>{const t=$(e);t.addClass("is-loading");const o=t.parents("tr"),s=o.parents("table"),a=t.attr("name");GAwesomeUtil.removeElement(o,s,`${window.location.pathname}/${a}`)})),GAwesomeUtil.dashboard.updateCommandSettings=((e,t)=>{const o=e.find(":input"),s=o.serializeArray(),a=s.filter(e=>e.name.match(/.*-disabled_channel_ids-.*/)).length,i=o.filter((e,t)=>$(t).attr("name").match(/.*-disabled_channel_ids-.*/)).length,n=((e,t,o)=>`${0===e?0===t?"Dis":"En":`Admin level &ge;${e}${0===t?", dis":", en"}`}abled in ${t-o==0||0===t?"all":t} channel${t-o==0||1!==t?"s":""}`)(Number(s.filter(e=>e.name.endsWith("-adminLevel"))[0].value),a,i);t.html(n)}),GAwesomeUtil.dashboard.post=(e=>new Promise((t,o)=>{$.ajax({url:window.location.pathname,method:"POST",data:e}).success(t).fail(o)})),GAwesomePaths.landing=(()=>{$(".section-shortcut-link").click(function(){$("html, body").animate({scrollTop:$(`#${this.href.substring(this.href.lastIndexOf("#")+1)}`).offset().top},172)})}),GAwesomePaths.activity=(()=>{GAwesomeUtil.activityViewportUpdate(GAwesomeListeners.activityMQL),"/activity/users"===window.location.pathname?(document.getElementById("search-button").href="javascript:GAwesomeUtil.searchUsers(document.getElementById('search-input').value);",document.getElementById("search-input").onkeydown=function(){13===event.keyCode&&GAwesomeUtil.searchUsers(this.value)},$.getJSON("/api/list/users",e=>{GAwesomeData.searchInputAutocomplete=new AutoComplete({selector:"#search-input",minChars:2,source:(t,o)=>{t=t.toLowerCase(),o(e.filter(e=>e.toLowerCase().indexOf(t)>-1))}})})):(GAwesomeData.activity.guildData={},document.getElementById("search-button").href="javascript:GAwesomeUtil.searchServers(document.getElementById('search-input').value);",document.getElementById("search-input").setAttribute("list","servers"),document.getElementById("search-input").onkeydown=function(){13===event.keyCode&&GAwesomeUtil.searchServers(this.value)},$.getJSON("/api/list/servers",e=>{GAwesomeData.searchInputAutocomplete=new AutoComplete({selector:"#search-input",minChars:2,source:(t,o)=>{t=t.toLowerCase(),o(e.filter(e=>e.toLowerCase().indexOf(t)>-1))}})}),GAwesomeUtil.switchActivityLayout(),GAwesomeUtil.showActivitySelections())}),GAwesomePaths.blog=(()=>{if(setTimeout(()=>{GAwesomeUtil.SFS()},0),$("#blog-header-subtitle")[0]&&GAwesomeUtil.setInterval(GAwesomeUtil.updateBlogSubtitle,6e4),!window.location.toString().endsWith("/compose")&&!window.location.toString().endsWith("/new"))return;const e=new showdown.Converter({tables:!0,simplifiedAutoLink:!0,strikethrough:!0,tasklists:!0,smoothLivePreview:!0,smartIndentationFix:!0});GAwesomeData.blog.editor=new SimpleMDE({element:document.getElementById("composer-content"),forceSync:!0,spellChecker:!1,promptURLs:!0,previewRender:t=>($(".editor-preview").addClass("content"),$(".editor-preview-side").addClass("content"),e.makeHtml(t))})}),GAwesomePaths.wiki=(()=>{if(setTimeout(()=>{GAwesomeUtil.SFS()},0),GAwesomeData.wiki.bookmarks=JSON.parse(localStorage.getItem("wiki-bookmarks"))||[],GAwesomeUtil.populateWikiBookmarks(),!window.location.toString().endsWith("/edit")&&!window.location.toString().endsWith("/new"))return;const e=new showdown.Converter({tables:!0,simplifiedAutoLink:!0,strikethrough:!0,tasklists:!0,smoothLivePreview:!0,smartIndentationFix:!0});GAwesomeData.wiki.editor=new SimpleMDE({element:document.getElementById("composer-content"),forceSync:!0,spellChecker:!1,promptURLs:!0,previewRender:t=>($(".editor-preview").addClass("content"),$(".editor-preview-side").addClass("content"),e.makeHtml(t))})}),GAwesomePaths.dashboard=(()=>GAwesomeUtil.dashboardWrapper(()=>{switch($(".close-update-modal").unbind(),$(".close-update-modal").click(()=>{$("html").removeClass("is-clipped"),$("#update-modal").removeClass("is-active")}),GAwesomeUtil.dashboard.connect(),window.location.pathname.split("/")[4]){case"command-options":$("#ban_gif").on("blur",()=>{if("Default"===$("#ban_gif").val())return $("#default_ban_gif").hide(),$("#ban_gif_field").removeClass("has-addons"),$("#ban_gif_preview").attr("src","https://imgur.com/3QPLumg.gif");$("#ban_gif_field").addClass("has-addons"),$("#default_ban_gif").show(),$("#ban_gif_preview").attr("src",$("#ban_gif").val())});break;case"name-display":{const e=$("#currentExample"),t=$("#name_display-use_nick"),o=$("#name_display-show_discriminator");t.click(()=>{t.is(":checked")&&""!==GAwesomeData.nickname?e.text(GAwesomeData.nickname):e.text(GAwesomeData.username),o.is(":checked")&&e.text(`${e.text().trim()}#${GAwesomeData.discriminator}`)}),o.click(()=>{o.is(":checked")?e.text(`${e.text()}#${GAwesomeData.discriminator}`):e.text(e.text().trim().slice(0,-5))});break}case"injection":{const e=document.getElementsByClassName("code-box");GAwesomeData.builders={};for(let t=0;t<e.length;t++){const o=e.item(t);GAwesomeData.builders[o.id]=CodeMirror.fromTextArea(o,{mode:"javascript",lineWrapping:!0,lineNumbers:!0,fixedGutter:!0,styleActiveLine:!0,theme:"monokai"}),GAwesomeData.builders[o.id].on("change",()=>GAwesomeData.builders[o.id].save())}break}case"extension-builder":GAwesomeData.builder=CodeMirror.fromTextArea(document.getElementById("builder-code-box"),{mode:"javascript",lineWrapping:!0,lineNumbers:!0,fixedGutter:!0,styleActiveLine:!0,theme:"monokai"})}})),GAwesomeListeners.activityMQL=window.matchMedia("screen and (max-width: 768px)"),GAwesomeListeners.activityMQL.addListener(GAwesomeUtil.activityViewPortUpdate),document.addEventListener("turbolinks:load",()=>{try{GAwesomeUtil.log("Start load page JS"),GAwesomeUtil.updateHeader(),bulma(),GAwesomeData.timers.forEach((e,t)=>{clearTimeout(e),GAwesomeData.timers.splice(t,1)}),GAwesomeData.HUM=!1,GAwesomeData.IFS=$("#form").serialize(),GAwesomeData.dashboard.socket&&(GAwesomeUtil.log("Closing stale Dashboard socket"),GAwesomeData.dashboard.socket.close(),delete GAwesomeData.dashboard.socket),GAwesomeData.section=window.location.pathname.split("/")[1];let e=GAwesomePaths[GAwesomeData.section];""===GAwesomeData.section&&(e=GAwesomePaths.landing),e&&e(),NProgress.done(!0),GAwesomeUtil.log(`Finished loading page using ${""!==GAwesomeData.section?GAwesomeData.section:"landing"} section handler`)}catch(e){NProgress.done(),NProgress.remove(),GAwesomeUtil.error(`An exception occurred while trying to prepare ${location.pathname}: ${e}`),swal("An exception occurred.",e.toString(),"error")}}),$(document).on("turbolinks:click",({originalEvent:e})=>{const t=document.createElement("a");t.href=e.data.url;const o=t.pathname.startsWith("/dashboard")&&"/dashboard"!==t.pathname,s=window.location.pathname.startsWith("/dashboard")&&"/dashboard"!==window.location.pathname;o&&s?NProgress.configure({parent:"section.section.is-white"}):NProgress.configure({parent:"body"}),NProgress.start()}),$(document).on("turbolinks:before-visit",e=>{const t=$("#form").serialize();if(GAwesomeData.IFS!==t){confirm("You have unsaved changes on this page. Are you sure you want to leave this page and discard your changes?")||(e.preventDefault(),NProgress.done(),NProgress.remove())}}),$(window).bind("beforeunload",e=>{const t=$("#form").serialize();if(GAwesomeData.IFS!==t){const t="You have unsaved changes on this page. Do you want to leave this page and discard your changes or stay on this page?";return e.returnValue=t,t}}),$(window).scroll(function(){$("#form-buttons")&&$("#form-buttons").is(":visible")?$("#scroll-top-button-container").css("padding-bottom","75px"):$("#scroll-top-button-container").css("padding-bottom","25px"),$(this).scrollTop()>200&&$(this).scrollTop()<$(document).height()-1200?$("#scroll-top-button-container").fadeIn(86):$("#scroll-top-button-container").fadeOut(86)}),$(window).scroll(()=>{$(window).scrollTop()+$(window).height()>$(document).height()-150&&"none"!==$("#form-buttons").css("display")&&$("#form-buttons").fadeOut(86)}),setInterval(()=>{const e=$("#form").serialize();GAwesomeData.IFS!==e&&(GAwesomeData.HUM=!1),$(window).scrollTop()+$(window).height()<=$(document).height()-150&&(GAwesomeData.IFS!==e&&"none"===$("#form-buttons").css("display")?$("#form-buttons").fadeIn(86):GAwesomeData.IFS===e&&"none"!==$("#form-buttons").css("display")&&$("#form-buttons").fadeOut(86))},1e3);let keys=[];const konami="38,38,40,40,37,39,37,39,66,65",dolphin="68,69,76,73,71,72,84,69,68,32,68,79,76,80,72,73,78",unknown="38c972419c82c3059933ecefee492ad2";window.addEventListener("keydown",e=>{16!==e.keyCode&&keys.push(e.keyCode),keys.toString().includes(konami)&&(keys=[],document.body.innerHTML=document.body.innerHTML.replace(/GAwesomeBot/g,"TacoBot"),document.body.innerHTML=document.body.innerHTML.split("/static/img/icon.png").join("/static/img/tinytaco.png"),document.getElementById("header").style.backgroundImage="url('/static/img/header-bg-taco.jpg')"),keys.toString().includes(dolphin)&&(keys=[],$("*").contents().filter(function(){return this.nodeType===Node.TEXT_NODE&&""!==this.nodeValue.trim()}).each(function(){let e="";for(let t=0;t<this.nodeValue.length;t++)e+="🐬";this.nodeValue=e})),md5(keys.toString())===unknown&&(keys=[],document.body.innerHTML=document.body.innerHTML.split("/GilbertGobbels/GAwesomeBot").join("/BitQuote/AwesomeBot"),document.body.innerHTML=document.body.innerHTML.replace(/GAwesomeBot/g,"AwesomeBot Neo"),document.body.innerHTML=document.body.innerHTML.split("/static/img/icon.png").join("/static/img/NEO.png"),$("#footerText").html('<strong>AwesomeBot NEO</strong> by BitQuote & <a href="https://github.com/BitQuote">BitQuote</a>. Made with <a href="https://github.com/BitQuote">BitQuote</a> and <a href="https://github.com/BitQuote">BitQuote</a>. Site made with <a href="https://github.com/BitQuote">BitQuote</a> and <a href="https://github.com/BitQuote">BitQuote</a>. Artwork by <a href="https://github.com/BitQuote">BitQuote</a> and <a href="https://github.com/BitQuote">BitQuote</a>. All rights reserved by BitQuote.'),$(".developer-card-name").html("BitQuote").attr("ondblclick",""),$(".developer-card-icon").attr("src","/static/img/bitquote.png"),$(".developer-card-role").html("(Evil) Creator, Bot Killer"))},!0);
